<!--
 * Asterisk-GUI	-	an Asterisk configuration interface
 *
 * Setup WIzard/ Top level page
 *
 * Copyright (C) 2006-2007, Digium, Inc.
 *
 * Mark Spencer <markster@digium.com>
 * Pari Nannapaneni <pari@digium.com>
 *
 * See http://www.asterisk.org for more information about
 * the Asterisk project. Please do not directly contact
 * any of the maintainers of this project for assistance;
 * the project provides a web site, mailing lists and IRC
 * channels for your use.
 *
 * This program is free software, distributed under the terms of
 * the GNU General Public License Version 2. See the LICENSE file
 * at the top of the source tree.
 *
-->
<HTML>
<HEAD>
<TITLE> Asterisk GUI Setup Wizard</TITLE>
	<link rel="shortcut icon" href="../images/favicon.ico" />
	<link href="setup.css" media="all" rel="Stylesheet" type="text/css" />
</HEAD>
<script src="../scripts/prototype.js"></script>
<script src="../scripts/astman.js"></script>
<script>
var rawman_url;
var fxoports = new Array();
var fxsports = new Array();
var numberofsteps = 7;
var loggedon = 0;
var localextenlength;
var keepPinging;
var started_pinging = 0;

/* Logoff and redirect user */
function log_red() {
	makerequest("","","action=logoff", function(t){ window.location.href="../cfgbasic.html"; } );
}

/* Make sure the user has proper permissions */
function check_auth() {
	makerequest('g',"users.conf",'', function(t){
	var response = t.split("\n");
	if(response[1].match("Message: Permission denied")) {
		alert("Your Permissions are not setup Correctly\nPlease add the proper read/write permissions in manager.conf\nClick OK when the changes are made.\n\nExample User:\n\n[kruz]\nsecret = blah\npermit = 127.0.0.1/255.0.0.0\nread = system,call,log,verbose,command,agent,user,config\nwrite = system,call,log,verbose,command,agent,user,config"); 
		log_red(); 
		return false;
	} else { 
		return true; 
	}});

}

function pingevery(a){
	keepPinging = setInterval( makeping, a*250 );
}

function makeping(){
	makerequest("","","action=ping", function(t){ if( t.match(asterisk_guipingerror) ){ window.location.href=window.location.href;} } );
}

function localinit(){
	rawman_url = "../" + asterisk_rawmanPath;
	asterisk_rawmanPath = "../" + asterisk_rawmanPath;
	astmanEngine = new Astman();
	astmanEngine.setURL(asterisk_rawmanPath);
	check_auth();
	_$('mainscreen').src="1.html";
}


</script>
<body onload="localinit()" topmargin=0  bgcolor="FFFFFF">
<TABLE width=800 cellpadding=0 cellspacing=0 border=0 align="center" style="border: 1px solid #660000; margin-top: 8px;">
	<TR><TD height=70 bgcolor="#EFEFEF" align="center">
		<TABLE cellpadding=0 cellspacing=0 border=0 width=780 align="center" >
		<TR><TD><IMG src="digiumlogo.gif" border=0></TD>
			<TD align="center">	<FONT SIZE="+1" COLOR="#666666">Welcome to Asterisk GUI setup wizard</FONT>
				<div id="feedback_round" style="display:none;background-color: #EFEFEF; width:400px" align="center">
					<div align="center" id='feedback' style="font-family: Arial, sans-serif, Helvetica, Trebuchet MS ;font-size: 13px;font-weight : bold;"></div>
				</div>
			</TD>
		</TR>
		</TABLE>
	     </TD>
	</TR>
	<TR><TD height=400><iframe width=785 height=396 frameborder="0" border="0" marginheight="0" marginwidth="0" id="mainscreen" SCROLLING=no></iframe></TD>
	</TR>
	<TR><TD height=50 bgcolor="#DBDBDB"  align="right" valign="middle">
		<TABLE cellpadding=0 cellspacing=0 width="130" border=0 align="right">
		<TR>	<TD><input type="button" id="back" value="Back"></TD>
					<TD align=right><input type="button" id="next" value="Next">&nbsp;&nbsp;&nbsp;&nbsp;</TD>
		</TR>
		</TABLE>
  	     </TD>
	</TR>
</TABLE>
<div id="copyright">Copyright &copy;2006-2007 Digium, Inc.  Digium&reg; and Asterisk&reg; are registered <a href="http://www.digium.com/en/company/profile/trademarkpolicy.php">trademarks</a> of Digium, Inc. All Rights Reserved. <i><a href="http://www.digium.com/en/company/profile/terms.php">Legal Information</a></i></div></body>
</html>
