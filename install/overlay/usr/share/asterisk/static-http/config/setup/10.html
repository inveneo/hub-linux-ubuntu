<!--
 * Asterisk-GUI	-	an Asterisk configuration interface
 *
 * Setup WIzard/ Finish Screen
 *
 * Copyright (C) 2006-2007, Digium, Inc.
 *
 * Mark Spencer <markster@digium.com>
 * Pari Nannapaneni <pari@digium.com>
 *
 * See http://www.asterisk.org for more information about
 * the Asterisk project. Please do not directly contact
 * any of the maintainers of this project for assistance;
 * the project provides a web site, mailing lists and IRC
 * channels for your use.
 *
 * This program is free software, distributed under the terms of
 * the GNU General Public License Version 2. See the LICENSE file
 * at the top of the source tree.
 *
-->
<HTML>
<HEAD>
	<TITLE> Asterisk GUI Setup Wizard</TITLE>
	<link href="setup.css" media="all" rel="Stylesheet" type="text/css" />
</HEAD>
<script src="../scripts/prototype.js"></script>
<SCRIPT>

var rawman_url;
var usercallbacks = new Object;
var fieldnames = new Array( 'save','userbase','localextenlength');
var widgets = new Array;

function localinit(){
	//parent.$('next').disabled = true;
	parent.$('next').onclick = function(){	 parent.window.location.href ="../cfgbasic.html"; };
	parent.$('back').disabled = false;
	parent.$('back').onclick  = function(){ window.location.href="8.html"; };
	rawman_url = parent.rawman_url ;
	parent.astmanEngine.setURL(rawman_url);
	ping();
}

function ping(){
	var opt = {
		method: 'get',
		asynchronous: true,
		onComplete: isloggedin
	};
	opt.parameters="action=ping" ;
	var tmp = new Ajax.Request(rawman_url , opt);
}

function isloggedin(originalRequest){
	if ( originalRequest.responseText.match("Error") ) {
		parent.window.location.href = parent.window.location.href ;
	}

	if ( originalRequest.responseText.match("Pong") ) {
		parent.astmanEngine.pollEvents();
		var f1 = function(){
			_$('msg_div').style.display = 'none';
			parent.$('back').disabled = false;
			parent.$('next').disabled = false;
		};
		var reloadConfig = function(){
			parent.$('back').disabled = true;
			parent.$('next').disabled = true;
			var uri = parent.build_action('renamecat', 0, "","", "", "");
			var r = "action=updateconfig&reload=yes&srcfilename=" + encodeURIComponent("extensions.conf") + "&dstfilename=" + encodeURIComponent("extensions.conf") + uri;
			parent.makerequest("","",r, setTimeout(f1,2000));
		};
		reloadConfig();
	}
}

</SCRIPT>
<BODY bgcolor="#FFFFFF" onload="localinit()" topmargin=0 leftmargin=0>
<table width="100%" height="100%" border=0 cellpadding=0 cellspacing=0>
	<tr>	
	<td width="170" valign=top align=left>
		<div id="menu">
		<table cellpadding=3 cellspacing=2 border=0 id="sidelist">
			<tr><td width=3></td><td>Start</td></tr>
			<tr><td></td><td>Verify Analog Ports</td></tr>
			<!-- <tr><td></td><td>Date & Time</td></tr> -->
			<tr><td></td><td>Local Extension Settings</td></tr>
			<tr><td></td><td>Service Providers</td></tr>
			<tr><td></td><td>Calling Rules</td></tr>
			<tr><td></td><td>VoiceMail Settings</td></tr>
			<tr><td></td><td>User Extensions</td></tr>
			<tr><td></td><td>Incoming Calls</td></tr>
			<!-- <tr><td></td><td>VoiceMenus</td></tr>
			<tr><td></td><td>Step 9 </td></tr> -->
			<tr><td></td><td class="slselected">Finish</td></tr>
		</table>
		</div>
	</td>
	<td valign=top align=center>
	<!--  this page -->
		<div class="heading"> Finish</div>
		<div class="subheading">
		Congratulations You have sucessfully configured your Asterisk installation<BR>
		Click Next to proceed to the User Interface</div>

		<BR><BR>
		<div id="msg_div" class="subheading">
			<BR><BR>
			<TABLE border=0 cellpadding=0 cellspacing=3 align=center>
			<TR>    <TD><img src=../images/loading.gif></TD>
				<TD valign=middle align=center>
					&nbsp;&nbsp;<font color="bd0e12"><span id="msg_div_span">Activating Changes ...</span></font>
				</TD>
			</TR>
			</TABLE> 
		</div>
	<!--  this page -->
	</td>
	</tr>
</table>
</BODY>
</HTML>
